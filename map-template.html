<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Map Template</title>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
<script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.1/mapbox.js'></script>
<script src='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-hash/v0.2.1/leaflet-hash.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.1/mapbox.css' rel='stylesheet' />
<style>
body { font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-size: 12px; margin:0; padding:0; }
section { border-bottom: 1px solid #CCC; }
h1 { font-size: 22px; margin: 0; }
h2 { font-size: 16px; margin-bottom: 3px; }
h3 { font-size: 14px; }
p, dt, dd { line-height: 18px; }
dt, dd { min-height: 20px }
dt { font-weight: bold; }
.dl-inline dt { clear: left; float: left; overflow: hidden; }
.dl-inline dd { margin-left: 160px; }
.dl-statTract dt:first-child, .dl-statTract dt:first-child+dd { min-height: 40px; margin-bottom: 5px; }
.dl-statTract dt:first-child { width: 160px; word-wrap: break-word; }
.help-inline { color: #444; font-style: italic; font-weight: normal; }
.table-data { border-collapse: collapse; }
.table-data th { background-color: #CCC; }
.table-data th, .table-data td { padding: 5px; }
.table-data th:first-child { text-align: left; }
caption { font-weight: bold; margin-bottom: 5px; text-align: left; }
.table-data td:first-child { width: 140px; }
.table-data th sup { font-size: 9px; }
tfoot { border-top: 2px solid #D3D3D3; }
tfoot sup { margin-right: 2px; position: relative; top: 2px; }
.table-legend td { font-size: 11px; padding: 5px 0 5px 5px; }
.table-legend td:nth-child(n+2) { text-align: center; }
#map { left: 0; position:absolute; top:0; bottom:0; width: 69%; }
#map-sidebar { position: absolute; right: 0; top: 0; width: 31%; }
#map-summary { padding: 10px; }
#map-legend { background-color: #FFF; border: 1px solid #CCC; bottom: 10px; font-family: Arial, Helvetica, sans-serif; font-size: 12px; padding: 5px; position: absolute; right: 0; }
.key-symbol { opacity: 0.75; }
.map-desc { font-size: 12px; }
.panel { border: 1px solid #CCCCCC; max-height: 200px; padding: 5px; }
.panel-scroll { overflow-y: auto; }
</style>
</head>
<body>
<div id="map"></div>
<div id="map-sidebar">
    <div id="map-summary">
        <h1>CAM Experiment Cost Map</h1>
        <p class="map-desc">Zoom in to display tract level details on mouseover below.</p>
        <div id="map-tooltip">
            <section>
                <h2>Selected Tract: <span id="stat-tract">---------</span></h2>
                (County: <span id="stat-cnty">------</span>, <span id="stat-state">--</span>)
                <dl class="dl-statTract dl-inline">
                    
                    <dt>Locations Unserved by an Unsubsidized Provider: </dt>
                    <dd><br><span id="stat-totloc">----</span></dd>
                    <dt>Total Annual Support:</dt>
                    <dd>$ <span id="stat-totsup">----</span></dd>
                    <dt>- Price cap:</dt>
                    <dd>$ <span id="stat-pcannsup">----</span></dd>
                    <dt>- Rate-of-return:</dt>
                    <dd>$ <span id="stat-rorannsup">----</span></dd>
                </dl>
            </section>
            <section>
                <h3><abbr title="Number">No.</abbr> of Locations >$50 <span style="font-size: 11px;">(per month, per location)</span></h3>
                <dl id="dl-numLocs" class="dl-inline">
                    <dt><abbr title="Price cap">PC</abbr> Locations Between: </dt>
                    <dd><span id="stat-pclocbtwn">-----</span></dd>
                    <dt><abbr title="Rate-of-return">ROR</abbr> Locations Between: </dt>
                    <dd><span id="stat-rorlocbtwn">-----</span></dd>
                    <dt><abbr title="Price cap">PC</abbr> Locations Above: </dt>
                    <dd><span id="stat-pclocabv">-----</span></dd>
                    <dt><abbr title="Rate-of-return">ROR</abbr> Locations Above: </dt>
                    <dd><span id="stat-rorlocabv">-----</span></dd>
                </dl>
            </section>            
        </div>
    </div>
</div>
<div id="map-legend">
    <table class="table-legend table-data">
        <caption>
        Model Landscape
        </caption>
        <thead>
            <tr>
                <th>Cost per location</th>
                <th>Served<sup>1</sup></th>
                <th>Unserved<sup>1</sup></th>
            </tr>
        </thead>
        <tfoot>
<tr>
            	<td colspan=3><sup>1</sup>SERVED:  Census blocks are considered served by an unsubsidized provider if they report 3 Mbps downstream / 768 kbps upstream Internet access in SBI round 7 data and report voice connections on FCC Form 477.
</td>
            </tr>
</tfoot>
        <tbody>
            <tr>
                <td style="white-space: nowrap;"><strong>Above</strong>
                  <br>Price cap: &ge; $183.53
                  <br>Rate-of-return: &ge; $300</td>
                <td><span class="key-symbol" style="color:#FFACA1">▉</span></td>
                <td><span class="key-symbol" style="color:#DC4E3D">▉</span></td>
            </tr>
            <tr>
                <td style="white-space: nowrap;"><strong>Between</strong>
                <br>Price cap: &gt; $50 and &lt; $183.53
                <br>Rate-of-return: &gt; $50 and &lt; $300</td>
                <td><span class="key-symbol" style="color:#C4F489">▉</span></td>
                <td><span class="key-symbol" style="color:#28925B">▉</span></td>
            </tr>
            <tr>
                <td style="white-space: nowrap;"><strong>Below</strong>
                <br>Price cap: &le; $50
                <br>Rate-of-return: &le; $50</td>
                <td><span class="key-symbol" style="color:#FBDA62">▉</span></td>
                <td><span class="key-symbol" style="color:#D99442">▉</span></td>
            </tr>            
        </tbody> 
    </table>
</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/libs/jquery-1.11.0.min.js"><\/script>')</script>  
<script>

// Setup map
var map = L.mapbox.map('map', 'fcc.map-kzt95hy6,fcc.cni885mi,fcc.xoiara4i', {legendControl: false, attributionControl: false, gridControl: false, maxZoom: 12})
            .setView([38.82, -94.96], 4);
var hash = L.hash(map);      

// Display the map tooltip in the sidebar
map.gridLayer.on('mousemove',function(o) {
	   
	var data;

	if (o.data != undefined) {
	   data = o.data;   
	   
		// Populate location other stats (teaser fields from map)
		$('#stat-cnty').text(data.county_name);
		$('#stat-state').text(data.state);		
		$('#stat-tract').text(data.tract);
		$('#stat-totloc').text(data.total_locations);
		$('#stat-totsup').text(formatComma(data.total_annual_support));
		
		// Additional Cost Stats (teaser fields from map)		
		$('#stat-pclocbtwn').text(data.pc_locations_between);
		$('#stat-rorlocbtwn').text(data.ror_locations_between);
		$('#stat-pclocabv').text(data.pc_locations_above_ttc);
		$('#stat-rorlocabv').text(data.ror_locations_above_ttc);
		$('#stat-pcannsup').text(formatComma(data.pc_annual_support));
		$('#stat-rorannsup').text(formatComma(data.ror_annual_support));
	
	
	} else { // Reset the text labels
		$('#stat-tract').text('---------');
		$('#stat-cnty').text('------');
		$('#stat-state, #stat-pcannsup, #stat-rorannsup').text('--');
		$('#stat-totloc, #stat-totsup').text('----');
		$('#dl-numLocs').find('span').text('-----');	
	}

});      

// Format dummy data with commas
function formatComma(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

// Position the map legend when the window is resized
$(window).on('resize', function(e) {
    var width = ($('#map-sidebar').width()/2) - ($('#map-legend').width()/2) - 5;
	$('#map-legend').css('right', width);
}).resize();

</script>
</body>
</html>
